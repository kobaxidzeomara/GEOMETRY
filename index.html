<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>áƒ¤áƒáƒœáƒ¯áƒ áƒ˜áƒ¡ áƒ­áƒ áƒ˜áƒ¡ áƒ™áƒ£áƒ—áƒ®áƒ˜áƒ¡ áƒ™áƒáƒšáƒ™áƒ£áƒšáƒáƒ¢áƒáƒ áƒ˜</title>
<style>
  :root{--accent:#0b73ff;--bg:#f6f8fd;--card:#fff;--orange:#ff6b00}
  *{box-sizing:border-box}
  body{font-family:Inter,Segoe UI,Arial,sans-serif;background:var(--bg);margin:0;padding:20px;display:flex;justify-content:center;min-height:100vh}
  .wrap{width:1100px;max-width:100%;display:grid;grid-template-columns:380px 1fr;gap:20px;align-items:start}
  .card{background:var(--card);padding:24px;border-radius:16px;box-shadow:0 6px 30px rgba(20,30,60,0.12)}
  h2{margin:0 0 18px;font-size:24px;font-weight:700;color:#1a1a1a}
  h3{margin:18px 0 10px;font-size:18px;font-weight:600;color:#333}
  label{display:block;font-size:15px;font-weight:500;margin-top:14px;color:#444}
  input[type=number]{width:100%;padding:14px 16px;border-radius:10px;border:2px solid #e2e6ef;font-size:16px;margin-top:8px;transition:border .2s}
  input[type=number]:focus{outline:0;border-color:var(--accent)}
  .shape-selector{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px}
  .shape-btn{padding:16px;border-radius:12px;border:2px solid #e6eefc;background:#fff;cursor:pointer;font-size:16px;font-weight:600;transition:all .2s;text-align:center}
  .shape-btn:hover{border-color:#b8d4ff;background:#f8fbff;transform:translateY(-2px)}
  .shape-btn.active{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 6px 16px rgba(11,115,255,0.35)}
  .tri-type-selector{display:none;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:14px}
  .tri-type-selector.active{display:grid}
  .tri-type-btn{padding:12px 10px;border-radius:10px;border:2px solid #e6eefc;background:#fff;cursor:pointer;font-size:14px;font-weight:500;transition:all .2s;text-align:center}
  .tri-type-btn:hover{border-color:#b8d4ff;background:#f8fbff}
  .tri-type-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
  .inputs-group{display:none}
  .inputs-group.active{display:block}
  .btn-group{display:flex;gap:10px;margin-top:16px}
  .btn{padding:14px;background:var(--accent);color:#fff;border:0;border-radius:10px;cursor:pointer;font-size:16px;font-weight:600;transition:all .2s;flex:1}
  .btn:hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(11,115,255,0.35)}
  .btn-reset{background:#e8eaef;color:#555}
  .btn-reset:hover{background:#d8dce5;box-shadow:0 3px 10px rgba(0,0,0,0.12)}
  .result{margin-top:18px;font-size:15px;background:#f8fbff;padding:18px;border-radius:12px;border:1px solid #e3f0ff;max-height:450px;overflow:auto}
  .small{font-size:14px;color:#666;margin-top:10px;line-height:1.6}
  .svgbox{display:flex;align-items:center;justify-content:center;background:#fff;border-radius:12px;padding:20px;box-shadow:0 4px 20px rgba(20,30,60,0.08);min-height:580px}
  svg{width:100%;height:100%;max-height:580px}
  table{width:100%;border-collapse:collapse;font-size:15px;margin-top:10px}
  td,th{padding:10px 12px;border-bottom:1px solid #f0f3f8;text-align:left}
  th{background:#f5f8fc;font-weight:600;color:#555;font-size:15px}
  tr:last-child td{border:0}
  .edge-selector{margin-top:14px}
  .edge-label{font-size:15px;font-weight:500;color:#555;margin-bottom:10px}
  .edge-btns{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .edge-btns.tri{grid-template-columns:1fr 1fr 1fr}
  .edgeBtn{padding:12px;border-radius:10px;border:2px solid #e6eefc;background:#fff;cursor:pointer;font-size:15px;font-weight:500;transition:all .2s;text-align:center}
  .edgeBtn:hover{border-color:#b8d4ff;background:#f8fbff}
  .edgeBtn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
  .note{font-size:14px;color:#666;background:#fffbf0;padding:12px;border-radius:10px;margin-top:14px;line-height:1.6;border-left:4px solid #ffc107}
  .highlight{color:var(--accent);font-weight:600}
  .warning{background:#fff3e0;border-left-color:var(--orange);color:#c85e00}
  @media(max-width:900px){
    .wrap{grid-template-columns:1fr}
    .svgbox{min-height:400px}
    .card{padding:20px}
    h2{font-size:22px}
    h3{font-size:17px}
    label{font-size:14px}
    input[type=number]{font-size:16px;padding:12px 14px}
    .shape-btn{font-size:15px;padding:14px}
    .btn{font-size:15px;padding:13px}
    table{font-size:14px}
    .result{font-size:14px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2>ğŸ“ áƒ¤áƒ˜áƒ’áƒ£áƒ áƒ˜áƒ¡ áƒ¢áƒ˜áƒáƒ˜</h2>
      <div class="shape-selector">
        <button class="shape-btn" data-shape="triangle">ğŸ”º áƒ¡áƒáƒ›áƒ™áƒ£áƒ—áƒ®áƒ”áƒ“áƒ˜</button>
        <button class="shape-btn active" data-shape="quad">â—¼ï¸ áƒáƒ—áƒ®áƒ™áƒ£áƒ—áƒ®áƒ”áƒ“áƒ˜</button>
      </div>

      <div class="tri-type-selector" id="triTypeSelector">
        <button class="tri-type-btn active" data-type="custom">ğŸ”§ áƒœáƒ”áƒ‘áƒ˜áƒ¡áƒ›áƒ˜áƒ”áƒ áƒ˜</button>
        <button class="tri-type-btn" data-type="equilateral">âš–ï¸ áƒ¢áƒáƒšáƒ’áƒ•áƒ”áƒ áƒ“áƒ</button>
        <button class="tri-type-btn" data-type="isosceles">ğŸ“ áƒ¢áƒáƒšáƒ¤áƒ”áƒ áƒ“áƒ</button>
      </div>

      <h2>ğŸ“ áƒ–áƒáƒ›áƒ”áƒ‘áƒ˜</h2>
      
      <div class="inputs-group" id="triangleCustom">
        <label>áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜ A (áƒ›áƒ›)</label>
        <input id="tri_a" type="number" step="1" value="800" placeholder="áƒ›áƒáƒ’: 800">
        <label>áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜ B (áƒ›áƒ›)</label>
        <input id="tri_b" type="number" step="1" value="900" placeholder="áƒ›áƒáƒ’: 900">
        <label>áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜ C (áƒ›áƒ›)</label>
        <input id="tri_c" type="number" step="1" value="1000" placeholder="áƒ›áƒáƒ’: 1000">
      </div>

      <div class="inputs-group" id="triangleEquilateral">
        <label>áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜ (áƒ§áƒ•áƒ”áƒšáƒ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜ áƒ—áƒáƒœáƒáƒ‘áƒáƒ áƒ˜áƒ) (áƒ›áƒ›)</label>
        <input id="tri_eq_side" type="number" step="1" value="1000" placeholder="áƒ›áƒáƒ’: 1000">
        <div class="small">âœ“ áƒ§áƒ•áƒ”áƒšáƒ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜ áƒ“áƒ áƒ™áƒ£áƒ—áƒ®áƒ” áƒ”áƒ áƒ—áƒœáƒáƒ˜áƒ áƒ˜áƒ (60Â°-60Â°-60Â°)</div>
      </div>

      <div class="inputs-group" id="triangleIsosceles">
        <label>áƒ¤áƒ£áƒ«áƒ” (áƒ¥áƒ•áƒ”áƒ“áƒ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜) (áƒ›áƒ›)</label>
        <input id="tri_iso_base" type="number" step="1" value="1200" placeholder="áƒ›áƒáƒ’: 1200">
        <label>áƒ—áƒáƒœáƒáƒ‘áƒáƒ áƒ˜ áƒ’áƒ•áƒ”áƒ áƒ“áƒ”áƒ‘áƒ˜ (áƒ›áƒáƒ áƒªáƒ®áƒ”áƒœáƒ áƒ“áƒ áƒ›áƒáƒ áƒ¯áƒ•áƒ”áƒœáƒ) (áƒ›áƒ›)</label>
        <input id="tri_iso_side" type="number" step="1" value="1000" placeholder="áƒ›áƒáƒ’: 1000">
        <div class="small">âœ“ áƒáƒ áƒ˜ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜ áƒ—áƒáƒœáƒáƒ‘áƒáƒ áƒ˜áƒ</div>
      </div>

      <div class="inputs-group active" id="quadInputs">
        <label>áƒ–áƒ”áƒ“áƒ áƒ¡áƒ˜áƒ’áƒáƒœáƒ” a (áƒ›áƒ›)</label>
        <input id="quad_a" type="number" step="1" value="800" placeholder="áƒ›áƒáƒ’: 800">
        <label>áƒ¥áƒ•áƒ”áƒ“áƒ áƒ¡áƒ˜áƒ’áƒáƒœáƒ” b (áƒ›áƒ›)</label>
        <input id="quad_b" type="number" step="1" value="950" placeholder="áƒ›áƒáƒ’: 950">
        <label>áƒ¡áƒ˜áƒ›áƒáƒ¦áƒšáƒ” áƒ›áƒáƒ áƒªáƒ®áƒœáƒ˜áƒ• hâ‚ (áƒ›áƒ›)</label>
        <input id="quad_h1" type="number" step="1" value="1500" placeholder="áƒ›áƒáƒ’: 1500">
        <label>áƒ¡áƒ˜áƒ›áƒáƒ¦áƒšáƒ” áƒ›áƒáƒ áƒ¯áƒ•áƒœáƒ˜áƒ• hâ‚‚ (áƒ›áƒ›)</label>
        <input id="quad_h2" type="number" step="1" value="1500" placeholder="áƒ›áƒáƒ’: 1500">
      </div>

      <div class="btn-group">
        <button class="btn" id="calcBtn">ğŸ”„ áƒ’áƒáƒ›áƒáƒ—áƒ•áƒšáƒ</button>
        <button class="btn btn-reset" id="resetBtn">ğŸ—‘ï¸ áƒ¬áƒáƒ¨áƒšáƒ</button>
      </div>

      <div class="edge-selector">
        <div class="edge-label">áƒáƒ˜áƒ áƒ©áƒ˜áƒ” áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜:</div>
        <div class="edge-btns" id="edgeBtnsContainer"></div>
      </div>

      <div class="note">
        ğŸ’¡ <strong>áƒ­áƒ áƒ˜áƒ¡ áƒ™áƒ£áƒ—áƒ®áƒ”</strong> = áƒ¨áƒ˜áƒ“áƒ áƒ™áƒ£áƒ—áƒ®áƒ˜áƒ¡ Â½<br>
        áƒ¨áƒ˜áƒ“áƒ áƒ™áƒ£áƒ—áƒ®áƒ” = áƒáƒ áƒ˜ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ¡ áƒ™áƒ•áƒ”áƒ—áƒ˜áƒ¡ áƒ™áƒ£áƒ—áƒ®áƒ”
      </div>

      <div id="results" class="result">
        áƒáƒ˜áƒ áƒ©áƒ˜áƒ” áƒ¤áƒ˜áƒ’áƒ£áƒ áƒ, áƒ©áƒáƒ¬áƒ”áƒ áƒ” áƒ–áƒáƒ›áƒ”áƒ‘áƒ˜ áƒ“áƒ áƒ“áƒáƒáƒ­áƒ˜áƒ áƒ” "áƒ’áƒáƒ›áƒáƒ—áƒ•áƒšáƒáƒ¡" ğŸ‘†
      </div>
    </div>

    <div class="card svgbox">
      <svg id="svg" viewBox="-50 -50 700 600" preserveAspectRatio="xMidYMid meet" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <filter id="shadow">
            <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.15"/>
          </filter>
        </defs>
        <g id="drawing"></g>
      </svg>
    </div>
  </div>
<script>
let currentShape = 'quad';
let currentTriType = 'custom';
let lastComputation = null;
let activeEdge = 'right';

function dot(u,v){return u.x*v.x + u.y*v.y}
function len(v){return Math.hypot(v.x,v.y)}
function angleBetween(u,v){
  let d = dot(u,v)/(len(u)*len(v));
  d = Math.max(-1, Math.min(1, d));
  return Math.acos(d);
}

function interiorAngleAt(prev, P, next){
  let v1 = {x: prev.x - P.x, y: prev.y - P.y};
  let v2 = {x: next.x - P.x, y: next.y - P.y};
  return angleBetween(v1,v2);
}

function edgeLength(P,Q){return Math.hypot(Q.x - P.x, Q.y - P.y)}

function computeTriangle(a,b,c){
  const angleA = Math.acos((b*b + c*c - a*a) / (2*b*c));
  const angleB = Math.acos((a*a + c*c - b*b) / (2*a*c));
  
  const pts = {
    A: {x:0, y:0},
    B: {x:c, y:0},
    C: {x:b * Math.cos(angleA), y:b * Math.sin(angleA)}
  };
  
  const order = [pts.A, pts.B, pts.C];
  const names = ['A','B','C'];
  let vertices = {};
  
  for(let i=0;i<3;i++){
    const P = order[i];
    const prev = order[(i+2)%3];
    const next = order[(i+1)%3];
    const angRad = interiorAngleAt(prev,P,next);
    vertices[names[i]] = {
      x:P.x, y:P.y,
      interior_deg: angRad * 180/Math.PI,
      cut_deg: (angRad * 180/Math.PI)/2
    };
  }
  
  const edges = {
    ab: {P:pts.A, Q:pts.B, pName:'A', qName:'B'},
    bc: {P:pts.B, Q:pts.C, pName:'B', qName:'C'},
    ca: {P:pts.C, Q:pts.A, pName:'C', qName:'A'}
  };
  
  for(let k in edges){
    const e = edges[k];
    e.length = edgeLength(e.P, e.Q);
    e.pInterior = vertices[e.pName].interior_deg;
    e.qInterior = vertices[e.qName].interior_deg;
    e.pCut = vertices[e.pName].cut_deg;
    e.qCut = vertices[e.qName].cut_deg;
  }
  
  return {pts, vertices, edges, shape:'triangle'};
}

function computeQuad(a,b,h1,h2){
  const pts = {
    TL: {x:0, y:0},
    TR: {x:a, y:0},
    BR: {x:b, y:h2},
    BL: {x:0, y:h1}
  };
  
  const order = [pts.TL, pts.TR, pts.BR, pts.BL];
  const names = ['TL','TR','BR','BL'];
  let vertices = {};
  
  for(let i=0;i<4;i++){
    const P = order[i];
    const prev = order[(i+3)%4];
    const next = order[(i+1)%4];
    const angRad = interiorAngleAt(prev,P,next);
    vertices[names[i]] = {
      x:P.x, y:P.y,
      interior_deg: angRad * 180/Math.PI,
      cut_deg: (angRad * 180/Math.PI)/2
    };
  }
  
  const edges = {
    top: {P:pts.TL, Q:pts.TR, pName:'TL', qName:'TR'},
    right: {P:pts.TR, Q:pts.BR, pName:'TR', qName:'BR'},
    bottom: {P:pts.BR, Q:pts.BL, pName:'BR', qName:'BL'},
    left: {P:pts.BL, Q:pts.TL, pName:'BL', qName:'TL'}
  };
  
  for(let k in edges){
    const e = edges[k];
    e.length = edgeLength(e.P, e.Q);
    e.pInterior = vertices[e.pName].interior_deg;
    e.qInterior = vertices[e.qName].interior_deg;
    e.pCut = vertices[e.pName].cut_deg;
    e.qCut = vertices[e.qName].cut_deg;
  }
  
  return {pts, vertices, edges, shape:'quad'};
}

const calcBtn = document.getElementById('calcBtn');
const resetBtn = document.getElementById('resetBtn');
const results = document.getElementById('results');
const svgGroup = document.getElementById('drawing');
const shapeButtons = document.querySelectorAll('.shape-btn');
const triTypeButtons = document.querySelectorAll('.tri-type-btn');
const triTypeSelector = document.getElementById('triTypeSelector');
const triangleCustom = document.getElementById('triangleCustom');
const triangleEquilateral = document.getElementById('triangleEquilateral');
const triangleIsosceles = document.getElementById('triangleIsosceles');
const quadInputs = document.getElementById('quadInputs');
const edgeBtnsContainer = document.getElementById('edgeBtnsContainer');

shapeButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    currentShape = btn.dataset.shape;
    shapeButtons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    
    triTypeSelector.classList.toggle('active', currentShape === 'triangle');
    updateTriangleInputs();
    quadInputs.classList.toggle('active', currentShape === 'quad');
    
    updateEdgeButtons();
    results.innerHTML = 'áƒáƒ˜áƒ áƒ©áƒ˜áƒ” áƒ¤áƒ˜áƒ’áƒ£áƒ áƒ, áƒ©áƒáƒ¬áƒ”áƒ áƒ” áƒ–áƒáƒ›áƒ”áƒ‘áƒ˜ áƒ“áƒ áƒ“áƒáƒáƒ­áƒ˜áƒ áƒ” "áƒ’áƒáƒ›áƒáƒ—áƒ•áƒšáƒáƒ¡" ğŸ‘†';
    svgGroup.innerHTML = '';
    lastComputation = null;
  });
});

triTypeButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    currentTriType = btn.dataset.type;
    triTypeButtons.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    updateTriangleInputs();
  });
});

function updateTriangleInputs(){
  triangleCustom.classList.remove('active');
  triangleEquilateral.classList.remove('active');
  triangleIsosceles.classList.remove('active');
  
  if(currentShape === 'triangle'){
    if(currentTriType === 'custom') triangleCustom.classList.add('active');
    else if(currentTriType === 'equilateral') triangleEquilateral.classList.add('active');
    else if(currentTriType === 'isosceles') triangleIsosceles.classList.add('active');
  }
}

function updateEdgeButtons(){
  edgeBtnsContainer.innerHTML = '';
  edgeBtnsContainer.className = 'edge-btns';
  
  if(currentShape === 'triangle'){
    edgeBtnsContainer.classList.add('tri');
    ['ab','bc','ca'].forEach(edge => {
      const btn = document.createElement('button');
      btn.className = 'edgeBtn';
      btn.dataset.edge = edge;
      btn.textContent = edge.toUpperCase();
      btn.addEventListener('click', () => setActiveEdge(edge));
      edgeBtnsContainer.appendChild(btn);
    });
    activeEdge = 'ab';
  } else {
    [
      {id:'top', label:'â¬†ï¸ áƒ–áƒ”áƒ“áƒ'},
      {id:'right', label:'â¡ï¸ áƒ›áƒáƒ áƒ¯áƒ•áƒ”áƒœáƒ'},
      {id:'bottom', label:'â¬‡ï¸ áƒ¥áƒ•áƒ”áƒ“áƒ'},
      {id:'left', label:'â¬…ï¸ áƒ›áƒáƒ áƒªáƒ®áƒ”áƒœáƒ'}
    ].forEach(({id, label}) => {
      const btn = document.createElement('button');
      btn.className = 'edgeBtn';
      btn.dataset.edge = id;
      btn.textContent = label;
      btn.addEventListener('click', () => setActiveEdge(id));
      edgeBtnsContainer.appendChild(btn);
    });
    activeEdge = 'right';
  }
}

function renderSVG(data){
  svgGroup.innerHTML = '';
  const pts = data.pts;
  const ptsArray = Object.values(pts);
  const maxX = Math.max(...ptsArray.map(p => p.x));
  const maxY = Math.max(...ptsArray.map(p => p.y));
  const minX = Math.min(...ptsArray.map(p => p.x));
  const minY = Math.min(...ptsArray.map(p => p.y));
  const width = maxX - minX;
  const height = maxY - minY;
  const scale = Math.min(500 / Math.max(width,1), 450 / Math.max(height,1));

  function S(p){return {x: (p.x - minX) * scale + 80, y: (p.y - minY) * scale + 60}}
  
  const scaledPts = {};
  for(let k in pts) scaledPts[k] = S(pts[k]);

  const poly = document.createElementNS('http://www.w3.org/2000/svg','polygon');
  const pointsStr = Object.values(scaledPts).map(p => `${p.x},${p.y}`).join(' ');
  poly.setAttribute('points', pointsStr);
  poly.setAttribute('fill','#fafcff');
  poly.setAttribute('stroke','#99c2ff');
  poly.setAttribute('stroke-width','3');
  poly.setAttribute('filter','url(#shadow)');
  svgGroup.appendChild(poly);

  for(let edgeId in data.edges){
    const edge = data.edges[edgeId];
    const pA = scaledPts[edge.pName];
    const pB = scaledPts[edge.qName];
    
    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    const line = document.createElementNS('http://www.w3.org/2000/svg','line');
    line.setAttribute('x1', pA.x); 
    line.setAttribute('y1', pA.y);
    line.setAttribute('x2', pB.x); 
    line.setAttribute('y2', pB.y);
    line.setAttribute('stroke','#2b6be6'); 
    line.setAttribute('stroke-width','4');
    line.setAttribute('stroke-linecap','round');
    line.setAttribute('data-edge', edgeId);
    line.style.cursor='pointer';
    line.style.transition='all 0.2s';
    line.addEventListener('click', ()=>{setActiveEdge(edgeId)});
    g.appendChild(line);

    const mx = (pA.x + pB.x)/2, my = (pA.y + pB.y)/2;
    const text = document.createElementNS('http://www.w3.org/2000/svg','text');
    text.setAttribute('x', mx); 
    text.setAttribute('y', my - 12);
    text.setAttribute('text-anchor','middle'); 
    text.setAttribute('font-size','15'); 
    text.setAttribute('font-weight','600');
    text.setAttribute('fill','#0b3b99');
    text.textContent = Math.round(edge.length) + ' mm';
    g.appendChild(text);
    svgGroup.appendChild(g);
  }

  for(let vName in data.vertices){
    const v = data.vertices[vName];
    const p = scaledPts[vName];
    
    const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
    c.setAttribute('cx', p.x); 
    c.setAttribute('cy', p.y);
    c.setAttribute('r','6');
    c.setAttribute('fill','#0b3b99');
    c.setAttribute('stroke','#fff');
    c.setAttribute('stroke-width','2');
    svgGroup.appendChild(c);

    const t = document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x', p.x + 12); 
    t.setAttribute('y', p.y + 5);
    t.setAttribute('font-size','14'); 
    t.setAttribute('font-weight','700');
    t.setAttribute('fill','#1a1a1a');
    t.textContent = vName;
    svgGroup.appendChild(t);
  }

  highlightEdge(activeEdge);
}

function highlightEdge(edgeId){
  const edgeBtns = edgeBtnsContainer.querySelectorAll('.edgeBtn');
  edgeBtns.forEach(b => b.classList.toggle('active', b.dataset.edge === edgeId));
  
  const lines = svgGroup.querySelectorAll('line[data-edge]');
  lines.forEach(l=>{
    if(l.getAttribute('data-edge') === edgeId){
      l.setAttribute('stroke','#ff6b00');
      l.setAttribute('stroke-width','6');
    } else {
      l.setAttribute('stroke','#2b6be6');
      l.setAttribute('stroke-width','4');
    }
  });
}

function showResults(data, edgeName){
  if(!data){
    results.innerHTML = '<div style="color:#999">áƒáƒ˜áƒ áƒ•áƒ”áƒšáƒáƒ“ áƒ“áƒáƒáƒ­áƒ˜áƒ áƒ” "áƒ’áƒáƒ›áƒáƒ—áƒ•áƒšáƒáƒ¡" ğŸ‘†</div>'; 
    return;
  }
  lastComputation = data;
  activeEdge = edgeName || activeEdge;
  highlightEdge(activeEdge);

  const e = data.edges[activeEdge];

  let html = `<h3>ğŸ“ áƒáƒ áƒ©áƒ”áƒ£áƒšáƒ˜ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜: <span class="highlight">${activeEdge.toUpperCase()}</span></h3>`;
  html += `<table><tbody>`;
  html += `<tr><th>áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ˜</th><th>áƒ¦áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ”áƒ‘áƒ</th></tr>`;
  html += `<tr><td><strong>áƒ¡áƒ˜áƒ’áƒ áƒ«áƒ”</strong></td><td><strong>${e.length.toFixed(1)} mm</strong></td></tr>`;
  html += `<tr><td>áƒ¬áƒ•áƒ”áƒ áƒ˜ ${e.pName} â€” áƒ¨áƒ˜áƒ“áƒ áƒ™áƒ£áƒ—áƒ®áƒ”</td><td>${e.pInterior.toFixed(2)}Â°</td></tr>`;
  html += `<tr><td>áƒ¬áƒ•áƒ”áƒ áƒ˜ ${e.pName} â€” áƒ­áƒ áƒ˜áƒ¡ áƒ™áƒ£áƒ—áƒ®áƒ”</td><td><strong>${e.pCut.toFixed(2)}Â°</strong></td></tr>`;
  html += `<tr><td>áƒ¬áƒ•áƒ”áƒ áƒ˜ ${e.qName} â€” áƒ¨áƒ˜áƒ“áƒ áƒ™áƒ£áƒ—áƒ®áƒ”</td><td>${e.qInterior.toFixed(2)}Â°</td></tr>`;
  html += `<tr><td>áƒ¬áƒ•áƒ”áƒ áƒ˜ ${e.qName} â€” áƒ­áƒ áƒ˜áƒ¡ áƒ™áƒ£áƒ—áƒ®áƒ”</td><td><strong>${e.qCut.toFixed(2)}Â°</strong></td></tr>`;
  html += `</tbody></table>`;

  const hasSharpAngle = e.pCut > 50 || e.qCut > 50;
  if(hasSharpAngle){
    html += `<div class="note warning">âš ï¸ <strong>áƒ§áƒ£áƒ áƒáƒ“áƒ¦áƒ”áƒ‘áƒ!</strong> áƒ“áƒáƒ‘áƒáƒšáƒ˜ áƒ™áƒ£áƒ—áƒ®áƒ” (áƒ­áƒ áƒ˜áƒ¡ áƒ™áƒ£áƒ—áƒ®áƒ” > 50Â°). áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ” áƒ¤áƒ˜áƒ¥áƒ¡áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ™áƒšáƒ”áƒ›áƒ˜.</div>`;
  }

  html += `<h3>ğŸ“Š áƒ§áƒ•áƒ”áƒšáƒ áƒ¬áƒ•áƒ”áƒ áƒ˜áƒ¡ áƒ“áƒ”áƒ¢áƒáƒšáƒ”áƒ‘áƒ˜</h3>`;
  html += `<table><thead><tr><th>áƒ¬áƒ•áƒ”áƒ áƒ˜</th><th>áƒ¨áƒ˜áƒ“áƒ áƒ™áƒ£áƒ—áƒ®áƒ”</th><th>áƒ­áƒ áƒ˜áƒ¡ áƒ™áƒ£áƒ—áƒ®áƒ”</th></tr></thead><tbody>`;
  for(let vName in data.vertices){
    const v = data.vertices[vName];
    html += `<tr><td><strong>${vName}</strong></td><td>${v.interior_deg.toFixed(2)}Â°</td><td><strong>${v.cut_deg.toFixed(2)}Â°</strong></td></tr>`;
  }
  html += `</tbody></table>`;

  results.innerHTML = html;
}

function setActiveEdge(name){
  activeEdge = name;
  if(lastComputation) showResults(lastComputation, name);
}

calcBtn.addEventListener('click', ()=>{
  let data;
  
  try {
    if(currentShape === 'triangle'){
      let a, b, c;
      
      if(currentTriType === 'equilateral'){
        const side = parseFloat(document.getElementById('tri_eq_side').value);
        if(isNaN(side) || side <= 0){
          results.innerHTML = '<div style="color:#d32f2f;padding:12px;background:#ffebee;border-radius:8px">âŒ áƒ¨áƒ”áƒáƒ•áƒ¡áƒ”áƒ— áƒ•áƒ”áƒšáƒ˜ áƒ“áƒáƒ“áƒ”áƒ‘áƒ˜áƒ—áƒ˜ áƒ áƒ˜áƒªáƒ®áƒ•áƒ˜áƒ—!</div>';
          return;
        }
        a = b = c = side;
      } else if(currentTriType === 'isosceles'){
        const base = parseFloat(document.getElementById('tri_iso_base').value);
        const side = parseFloat(document.getElementById('tri_iso_side').value);
        if([base, side].some(x => isNaN(x) || x <= 0)){
          results.innerHTML = '<div style="color:#d32f2f;padding:12px;background:#ffebee;border-radius:8px">âŒ áƒ¨áƒ”áƒáƒ•áƒ¡áƒ”áƒ— áƒ§áƒ•áƒ”áƒšáƒ áƒ•áƒ”áƒšáƒ˜ áƒ“áƒáƒ“áƒ”áƒ‘áƒ˜áƒ—áƒ˜ áƒ áƒ˜áƒªáƒ®áƒ•áƒ”áƒ‘áƒ˜áƒ—!</div>';
          return;
        }
        if(side + side <= base){
          results.innerHTML = '<div style="color:#d32f2f;padding:12px;background:#ffebee;border-radius:8px">âŒ áƒ’áƒ•áƒ”áƒ áƒ“áƒ”áƒ‘áƒ˜ áƒ«áƒáƒšáƒ˜áƒáƒœ áƒ›áƒáƒ™áƒšáƒ”áƒ! áƒáƒ áƒ˜ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ¡ áƒ¯áƒáƒ›áƒ˜ áƒ£áƒœáƒ“áƒ áƒ˜áƒ§áƒáƒ¡ áƒ¤áƒ£áƒ«áƒ”áƒ–áƒ” áƒ›áƒ”áƒ¢áƒ˜.</div>';
          return;
        }
        c = base;
        a = b = side;
      } else {
        a = parseFloat(document.getElementById('tri_a').value);
        b = parseFloat(document.getElementById('tri_b').value);
        c = parseFloat(document.getElementById('tri_c').value);
        
        if([a, b, c].some(x => isNaN(x) || x <= 0)){
          results.innerHTML = '<div style="color:#d32f2f;padding:12px;background:#ffebee;border-radius:8px">âŒ áƒ¨áƒ”áƒáƒ•áƒ¡áƒ”áƒ— áƒ§áƒ•áƒ”áƒšáƒ áƒ•áƒ”áƒšáƒ˜ áƒ“áƒáƒ“áƒ”áƒ‘áƒ˜áƒ—áƒ˜ áƒ áƒ˜áƒªáƒ®áƒ•áƒ”áƒ‘áƒ˜áƒ—!</div>';
          return;
        }
        
        if(a + b <= c || a + c <= b || b + c <= a){
          results.innerHTML = '<div style="color:#d32f2f;padding:12px;background:#ffebee;border-radius:8px">âŒ áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜ áƒ¡áƒáƒ›áƒ™áƒ£áƒ—áƒ®áƒ”áƒ“áƒ˜! áƒœáƒ”áƒ‘áƒ˜áƒ¡áƒ›áƒ˜áƒ”áƒ áƒ˜ áƒáƒ áƒ˜ áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒ¡ áƒ¯áƒáƒ›áƒ˜ áƒ£áƒœáƒ“áƒ áƒ˜áƒ§áƒáƒ¡ áƒ›áƒ”áƒ¡áƒáƒ›áƒ”áƒ–áƒ” áƒ›áƒ”áƒ¢áƒ˜.</div>';
          return;
        }
      }
      
      data = computeTriangle(a, b, c);
      
    } else {
      const a = parseFloat(document.getElementById('quad_a').value);
      const b = parseFloat(document.getElementById('quad_b').value);
      const h1 = parseFloat(document.getElementById('quad_h1').value);
      const h2 = parseFloat(document.getElementById('quad_h2').value);
      
      if([a, b, h1, h2].some(x => isNaN(x) || x <= 0)){
        results.innerHTML = '<div style="color:#d32f2f;padding:12px;background:#ffebee;border-radius:8px">âŒ áƒ¨áƒ”áƒáƒ•áƒ¡áƒ”áƒ— áƒ§áƒ•áƒ”áƒšáƒ áƒ•áƒ”áƒšáƒ˜ áƒ“áƒáƒ“áƒ”áƒ‘áƒ˜áƒ—áƒ˜ áƒ áƒ˜áƒªáƒ®áƒ•áƒ”áƒ‘áƒ˜áƒ—!</div>';
        return;
      }
      
      data = computeQuad(a, b, h1, h2);
    }
    
    renderSVG(data);
    showResults(data, activeEdge);
    
  } catch(err) {
    results.innerHTML = `<div style="color:#d32f2f;padding:12px;background:#ffebee;border-radius:8px">âŒ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: ${err.message}</div>`;
    console.error(err);
  }
});

resetBtn.addEventListener('click', ()=>{
  document.getElementById('tri_a').value = '800';
  document.getElementById('tri_b').value = '900';
  document.getElementById('tri_c').value = '1000';
  document.getElementById('tri_eq_side').value = '1000';
  document.getElementById('tri_iso_base').value = '1200';
  document.getElementById('tri_iso_side').value = '1000';
  document.getElementById('quad_a').value = '800';
  document.getElementById('quad_b').value = '950';
  document.getElementById('quad_h1').value = '1500';
  document.getElementById('quad_h2').value = '1500';
  
  results.innerHTML = 'áƒáƒ˜áƒ áƒ©áƒ˜áƒ” áƒ¤áƒ˜áƒ’áƒ£áƒ áƒ, áƒ©áƒáƒ¬áƒ”áƒ áƒ” áƒ–áƒáƒ›áƒ”áƒ‘áƒ˜ áƒ“áƒ áƒ“áƒáƒáƒ­áƒ˜áƒ áƒ” "áƒ’áƒáƒ›áƒáƒ—áƒ•áƒšáƒáƒ¡" ğŸ‘†';
  svgGroup.innerHTML = '';
  lastComputation = null;
});

updateEdgeButtons();
</script>
</body>
</html>